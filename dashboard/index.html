<html>
<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    
	var json = [];
	var index = index || 1;
	
	function readTemps() {
	
		var obj = [];
		//var tempdata = cpf.get("temperature sensor");
		
		var d = new Date();
		var time = d.getHours() + ":" +d.getMinutes() + ":" + d.getSeconds() + "." + d.getMilliseconds();
		
		obj = {"key":index, "value": [{"date":time, "temperature":123}]};
		json.push(obj);
		
		document.getElementById("temp").innerHTML = index;
		
		index += 1;
		
		setTimeout("readTemps()", 1000);
	}
	
	function upload() {
		var str = JSON.stringify(json);
		aop.setStore("store1", str);
	}
	
	function download() {
	
		google.charts.load('current', {'packages':['line']});
		google.charts.setOnLoadCallback(drawChart);	
	
	}
	
	function drawChart() {
	
      var data = new google.visualization.DataTable();
      data.addColumn('number', 'Time of Day');
      data.addColumn('number', 'Temperature Data');
	  
	  var store = aop.getStore("store1");
	  var data = JSON.parse(store);
	  
	  for (var i in data){
		
		data.addRows([
			[i, data.value.temperature]
		  ]);
	  }

      var options = {
        chart: {
          title: 'Average Temperatures in Taipei Throughout the Day',
          subtitle: 'Celsius'
        },
        width: 900,
        height: 500,
		series: {
          // Gives each series an axis name that matches the Y-axis below.
          0: {axis: 'Temps'}
        },
        axes: {
          // Adds labels to each axis; they don't have to match the axis names.
          y: {
            Temps: {label: 'Temps (Celsius)'}
          }
        }
      };

      var chart = new google.charts.Line(document.getElementById('dashboard'));

      chart.draw(data, options);
	  
    }
	
	// Temperature
	function toCelsius(value) {
		var resistance = parseFloat((1023-value) * 10000 / value);
		var temperature = 1 / (Math.log(resistance / 10000) / 3975+1 / 298.15) - 273.15;
		
		return temperature.toFixed(1);
	}
	
  </script>
</head>
<body>

	<div id="temp"></div>
	<div id="dashboard"></div>
	
	<button id="upload" onclick="readTemps()">Read Temps</button>
	<button id="upload" onclick="upload()">Upload</button>
	<button id="download" onclick="download()">Make Dashboard</button>
</body>
</html>