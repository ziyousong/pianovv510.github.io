<html>
<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
      google.charts.load('current', {'packages':['line']});
      google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
	
      var data = new google.visualization.DataTable();
      data.addColumn('number', 'Day');
      data.addColumn('number', 'Temperature Data');

	  for (var index = 1; index <= 10 ; index++){
		
		var tempdata = cpf.get("temperature sensor");
		
		var celsius = toCelsius(tempdata);
		
		var obj = {"temperature": celsius};
		var str = JSON.stringify(obj);
		var storeId = "store" + index;
		aop.setStore(storeId, str);
		
		document.getElementById("temp").innerHTML = celsius;
	
	  }
	  
	  for (var i = 1; i <= 10 ; i++){
	  
		var storeId = "store" + i;
		var store = aop.getStore(storeId);
		var temp = JSON.parse(store);
		
		data.addRows([
			[i,  temp.temperature]
		  ]);
	  }

      var options = {
        chart: {
          title: '30 Day Temperature Dashboard',
          subtitle: 'Celsius'
        },
        width: 900,
        height: 500
      };

      var chart = new google.charts.Line(document.getElementById('dashboard'));

      chart.draw(data, options);
	  
    }
	
	// Temperature
	function toCelsius(value) {
		var resistance = parseFloat((1023-value) * 10000 / value);
		var temperature = 1 / (Math.log(resistance / 10000) / 3975+1 / 298.15) - 273.15;
		
		return temperature.toFixed(2);
	}
	
  </script>
</head>
<body>
	<div id="temp"></div>
  <div id="dashboard"></div>
</body>
</html>